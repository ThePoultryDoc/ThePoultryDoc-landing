<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5DLV2YVSDP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-5DLV2YVSDP');
  </script>

  <!-- Cloudflare Turnstile script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Poultry Doc | Backyard Chicken Vet Help & Support</title>
  <meta name="description" content="Get help with backyard poultry care from licensed veterinarians. Symptom guidance, consult options, and trusted poultry resources from The Poultry Doc.">
  <link rel="canonical" href="https://thepoultrydoc.com/" />

  <!-- Open Graph -->
  <meta property="og:title" content="The Poultry Doc | Backyard Chicken Vet Help & Support">
  <meta property="og:description" content="Get trusted vet-reviewed help for your backyard chickens.">
  <meta property="og:url" content="https://thepoultrydoc.com/">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://thepoultrydoc.com/logo.png">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="The Poultry Doc | Backyard Chicken Vet Help & Support">
  <meta name="twitter:description" content="Get help with your chickens from licensed vets. Symptom tools, answers, and more.">
  <meta name="twitter:image" content="https://thepoultrydoc.com/logo.png">

  <link rel="stylesheet" href="styles.css">

  <script>
    async function handleFormSubmit(event) {
      event.preventDefault();
      const form = event.target;
      const data = new FormData(form);

      // Show loading state
      const submitButton = form.querySelector('button[type="submit"]');
      // Declare originalButtonText outside the if block so it's available in the finally block
      let originalButtonText = "Notify Me"; // Default value

      if (submitButton) {
        originalButtonText = submitButton.textContent; // Save the original text
        submitButton.textContent = "Submitting...";
        submitButton.disabled = true;
      }

      // Safely access elements with null checks
      const successMessage = document.getElementById("google-success-message");
      const errorMessage = document.getElementById("error-message");

      // Hide previous messages if they exist
      if (successMessage) {
        successMessage.style.display = "none";
      }
      if (errorMessage) {
        errorMessage.style.display = "none";
      }

      // Send to your Cloudflare worker
      fetch("https://turnstile-worker.grayson-ad1.workers.dev", {
        method: "POST",
        body: data
      })
              .then(response => response.json())
              .then(async result => {
                if (result.success) {
                  if (successMessage) {
                    successMessage.style.display = "block";
                  }

                  // Get form field values for GTM
                  const firstName = data.get("First Name") || "";
                  const email = data.get("Email") || ""

                  // Push event to the data layer
                  window.dataLayer = window.dataLayer || [];
                  window.dataLayer.push({
                    'event': 'form_submission',
                    'form_name': 'newsletter_signup',
                    'submission_status': 'success',
                    'user_data': {
                      'first_name': firstName,
                      'email_hash': await hashEmail(email)
                    }
                  });

                  form.reset();
                } else {
                  if (errorMessage) {
                    errorMessage.textContent = result.error || "Submission failed. Please try again.";
                    errorMessage.style.display = "block";

                    window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                      'event': 'form_submission',
                      'form_name': 'newsletter_signup',
                      'submission_status': 'failure',
                      'error_message': result.error || "Submission failed"
                    });

                  }
                }
              })
              .catch(error => {
                if (errorMessage) {
                  errorMessage.textContent = "There was a problem submitting the form.";
                  errorMessage.style.display = "block";
                }

                // Track errors
                window.dataLayer = window.dataLayer || [];
                window.dataLayer.push({
                  'event': 'form_submission',
                  'form_name': 'newsletter_signup',
                  'submission_status': 'error',
                  'error_message': 'Network or server error'
                });

                console.error(error);
              })
              .finally(() => {
                // Reset button state
                if (submitButton) {
                  submitButton.textContent = originalButtonText; // Now it's accessible here
                  submitButton.disabled = false;
                }

                // Refresh the Turnstile widget if it exists
                if (typeof turnstile !== 'undefined') {
                  turnstile.reset();
                }
              });
    }

    async function hashEmail(email) {
      const encoder = new TextEncoder();
      const data = encoder.encode(email.trim().toLowerCase());
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hexHash;
    }
  </script>
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "The Poultry Doc",
      "url": "https://thepoultrydoc.com",
      "logo": "https://thepoultrydoc.com/logo.png"
    }
  </script>
</head>
<body>
<div class="container">
  <img src="https://thepoultrydoc.github.io/ThePoultryDoc-landing/TPD-logo-email.png?v=2" alt="The PoultryDoc Logo" class="logo" />
  <p class="tagline">Bringing board-certified poultry medicine to the backyard</p>
  <p class="description">We're hatching something special. Sign up to be the first to know when we go live.</p>

  <form action="#" method="POST" onsubmit="handleFormSubmit(event)">
    <input type="text" name="First Name" placeholder="First Name" required />
    <input type="text" name="Last Name" placeholder="Last Name" required />
    <input type="email" name="Email" placeholder="Your email address" required />

    <!-- Invisible Turnstile widget -->
    <div class="cf-turnstile" data-sitekey="0x4AAAAAABee5-hJ7K2QW-ke" data-size="invisible"></div>

    <button type="submit">Notify Me</button>
  </form>

  <div id="google-success-message" class="success-message">Thanks! We'll keep you in the loop üêî</div>
  <div id="error-message" class="error-message">There was a problem submitting the form.</div>
  <div class="footer">¬© 2025 ThePoultryDoc Incorporated | All rights reserved</div>
</div>
</body>
</html>